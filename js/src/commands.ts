import {
  JupyterFrontEnd,
} from "@jupyterlab/application";

import { ICommandPalette } from "@jupyterlab/apputils";
import { ILauncher } from "@jupyterlab/launcher";

import { IFrameWidget } from "./iframe";


export interface Site {
  path: string;
  openOnLoad: boolean;
  launcher: boolean;
  customIcon: string;
}

export async function addPageLoadSite(site: Site, app: JupyterFrontEnd) {
  app.restored.then(() => {
    const {path} = site;
    if (!localStorage.getItem("jupyterlab_iframe_welcome")) {
      localStorage.setItem("jupyterlab_iframe_welcome", "false");
      app.commands.execute(`iframe:open-${path}`);
    }
  });
}

export async function addLauncherSite(site: Site, app: JupyterFrontEnd, launcher: ILauncher) {
  const {path, customIcon} = site;
  launcher.add({
    args: { isLauncher: true, kernelName: "template" },
    category: "Notebook",
    command: `iframe:open-${path}`,
    // TODO
    kernelIconUrl: !customIcon && path.startsWith("http") ? `https://www.google.com/s2/favicons?domain=${path}`: "data:image/png;base64,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",
    rank: 1,
  });  
}

export async function addCommandPaletteSite(site: Site, app: JupyterFrontEnd, palette: ICommandPalette) {
  const {path} = site;
  const command = `iframe:open-${path}`;
  app.commands.addCommand(command, {
    execute: () => {
      const widget = new IFrameWidget(path);
      app.shell.add(widget);
      app.shell.activateById(widget.id);
    },
    isEnabled: () => true,
    label: path.replace(/https:\/\//, "").replace(/http:\/\//, "").replace(/local:\/\//, "").replace(/www\./, ""),
  });
  palette.addItem({ command, category: "Sites" });
}
